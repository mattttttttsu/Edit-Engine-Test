<?xml version="1.0"?>
<page title="FOLKTAIL -DIARY-" menu="home" lang="ja">
	
	<content>
	
		<articles>
<!--
			<article date="2007-05-20">
				<title>テキストのエンコーディング変換</title>
				<body>
					<p>いよいよ、エディット系コンポーネント</p>
					<p>あと、今日遂に我が家のエアコンが復活した。</p>
					
				</body>
			</article>
-->
			<article date="2007-05-19">
				<title>選択範囲の実装2、文字コード</title>
				<body>
					<p>先週に続きテキストの選択の実装を進めた。で、昨日あたりにようやく完成。
					まだマウスを使っての選択とかはできないけどその辺はすぐ対応できると思う。</p>
					<p>次に、何気に実装してなかった横スクロールも実装した。水平スクロールバーを付けてみて
					初めて気がついたけど、エディットボックスの原型にするウィンドウを間違えていた。
					今までは、"エディットボックスはオーナードローできない"ということでスタティックコントロールを
					オーナードロー指定して作っていたんだけど、これだと水平／垂直スクロールバーをつけた時に
					表示がおかしなことになる。(というかスタティックコントロールの場合、そもそもWS_VSCROLLとかのウィンドウスタイルを
					指定してスクロールバーを付けてもスクロールバーとして機能してくれない)</p>
					<p>あらためて他のアプリのソースを見てみると、単純なウィンドウを自分で定義して、
					オーナードローというよりはWM_PAINT(要するにOnPaint)をハンドルして実装してることがわかった。
					なので、この部分のコードは総書換え。おかげでコード量は短くなったし、アプリの外観もすっきりした。</p>
					
				</body>
			</article>
			
			<article date="2007-05-14">
				<title>選択範囲の実装</title>
				<body>
					<p>今日はテキストの選択の実装を行った。本当はテキストの入力あたりまで進める
					つもりだったけど、なかなか作業に集中できなくて結局今日だけではテキスト
					選択の実装は終わらなかった。ほとんど一日中家に居たのに・・・。最悪な日曜日の過ごし方。</p>
					<p>
					唯一いつもと違うことをしたのは、アイスコーヒーを作るセットを買ったこと。
					よくよく考えてみたらインスタントコーヒーに氷を入れればいいだけの話だったんだけど、
					何となく粉のやつを買ってみた。フィルターも合わせて買って早速作ってみたけど、
					味の違いがわからない・・・。でもとりあえず、10杯1セットとかで売ってるドリップ式のやつを
					買うよりは粉+フィルターの組み合わせで買った方が経済的な気がする。</p>
				</body>
			</article>

			<article date="2007-05-13">
				<title>続・キャレットの移動</title>
				<body>
					<p>キャレットの表示・移動ができるようになった。今は細かい設計抜きで"動けばいい"というスタンスで作ってるから
					数時間もあれば対応できるはずだったんだけど、結局4日近くかかってしまった(やる時間がなかったのもあるけど)。
					</p>
					<p>この前も書いた通り当初の予定では、十字キーが押されたら1文字分移動や1行移動するだけで良いと思っていた。
					しかし、全角半角が混ざったテキストやプロポーショナルフォントを使用している場合、
					縦方向に移動した後でキャレットの横位置を調整しないとおかしな位置に移動してしまう問題があった。</p>
					<p>この問題については結局、バッファ上のキャレット(文字数単位)とビュー上のキャレット(ピクセル単位)を
					作成し、互いを同期させることで対応した。横方向にキャレットを移動する場合は、バッファ上のキャレットを一文字
					移動させた後、ビュー用のキャレットを同期させる。縦方向の場合はビュー用のキャレットを移動させた後、
					バッファ上のキャレットを同期させる。</p>
					<p>設計せずに勢いで作ってるのでこの辺りのコードはグチャグチャ。落ち着いたら整理しないと。</p>
					<p>とりあえず次はテキストの選択をできるようにする。</p>
					
				</body>
			</article>

			<article date="2007-05-08">
				<title>キャレットの移動</title>
				<body>
					<p>何とかスクロールもできるようになってきた。これでキャレットを表示できるように
					なればちょっとは形になってくるかなぁと思って昨日あたりからキャレットの表示に
					取りかかり始めたけど、これが思いの他難しそう。</p>
					<p>テキストエディタでは横方向にキャレットを移動させる場合、キャレットを単に
					１文字分横に移動させるだけでいい。ところが縦方向の移動の場合、行を1行ずらした
					だけだと正しく移動しているように見えない。これは等幅フォントを使用していなかったり
					全角半角が混ざったテキストを扱っている場合に発生する。(カーソルを下へ移動した途端斜め下へ移動してしまう)</p>
					<p>他のエディタのソースコードを見させてもらった感じだと、縦方向の移動の時は"Y座標"は1行そのまま下へ移動、
					X方向は画面上の座標に合わせて自動調整することで対応してるように思えた。</p>
					<p>実際の画面上の表示(フォントサイズや書体)に合わせて何文字目に合わせればいいかを
					計算する感じで。幸いこのロジックはマウスでキャレットを移動した時も使うので、
					そこまで強引な解決方法というわけでもないと思う。</p>
					<p>何にしても、思っている以上に面倒で驚いた。明日の朝から頑張って実装してみよう。</p>
					
				</body>
			</article>
			<article date="2007-04-21">
				<title>とりあえず</title>
				<body>昨日は行番号の表示ができるようになった。</body>
			</article>
			<article date="2007-04-20">
				<title>日記開始。</title>
				<body>日記を始めて見る。</body>
			</article>
		</articles>
	
	</content>
	
</page>
